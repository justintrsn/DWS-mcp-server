query_scenarios:
  database_overview:
    description: "Get overview of database and its contents"
    max_tool_calls: 4
    timeout_seconds: 30
    queries:
      - "What's in this database and how big is it?"
      - "Show me all the tables and their structure"
      - "What schemas are available in the database?"
    expected_tools: ["database_stats", "list_tables", "describe_table", "schemas_list"]
    expected_entities: ["test_footfall", "anime", "studios", "public"]
    validation:
      require_database_info: true
      require_table_list: true

  table_discovery:
    description: "Explore table structure and relationships"
    max_tool_calls: 5
    timeout_seconds: 25
    queries:
      - "What tables are available and what do they contain?"
      - "Describe the structure of the anime table in detail"
      - "What are the relationships between the anime and studios tables?"
    expected_tools: ["list_tables", "describe_table"]
    expected_entities: ["anime", "studios", "studio_id", "PRIMARY KEY", "FOREIGN KEY"]
    validation:
      require_column_details: true
      require_constraint_info: true

  data_quality_analysis:
    description: "Analyze data quality and find statistical outliers"
    max_tool_calls: 6
    timeout_seconds: 35
    queries:
      - "Are there any data quality issues in the anime dataset?"
      - "Find outliers in anime ratings, popularity, and episode counts"
      - "What are the statistical distributions for numeric columns?"
    expected_tools: ["column_statistics", "table_statistics"]
    expected_entities: ["outliers", "score", "popularity", "episodes", "IQR"]
    validation:
      require_outlier_analysis: true
      require_statistical_summary: true

  performance_health:
    description: "Check database performance and connection health"
    max_tool_calls: 3
    timeout_seconds: 20
    queries:
      - "How is the database performing right now?"
      - "What's the current connection status and usage?"
      - "Are there any performance bottlenecks or warnings?"
    expected_tools: ["database_stats", "connection_info"]
    expected_entities: ["transactions", "cache_hit_ratio", "connections", "uptime"]
    validation:
      require_performance_metrics: true
      require_connection_stats: true

  studio_information:
    description: "Analyze studio data and structure"
    max_tool_calls: 4
    timeout_seconds: 25
    queries:
      - "Tell me about the studios table - what information does it contain?"
      - "What are the statistics for the studios data?"
      - "How many studios are in the database and what are their details?"
    expected_tools: ["describe_table", "table_statistics", "list_tables"]
    expected_entities: ["studios", "name", "founded_year", "country", "website"]
    validation:
      require_studio_schema: true
      require_row_counts: true

  comprehensive_analysis:
    description: "Full database analysis combining multiple aspects"
    max_tool_calls: 8
    timeout_seconds: 45
    queries:
      - "Give me a comprehensive overview of this anime database - structure, content, and data quality"
      - "What can you tell me about the relationships and data patterns in this database?"
    expected_tools: ["database_stats", "list_tables", "describe_table", "table_statistics", "column_statistics", "schemas_list"]
    expected_entities: ["anime", "studios", "outliers", "statistics", "foreign key", "test_footfall"]
    validation:
      require_multi_table_analysis: true
      require_relationship_explanation: true
      require_data_quality_assessment: true

  edge_case_testing:
    description: "Test edge cases and error handling"
    max_tool_calls: 3
    timeout_seconds: 20
    queries:
      - "What information can you find about a table called 'nonexistent_table'?"
      - "Analyze the data quality of all tables in the database"
    expected_tools: ["describe_table", "column_statistics", "table_statistics"]
    expected_entities: ["error", "not found", "anime", "studios"]
    validation:
      expect_error_handling: true
      require_graceful_fallback: true

  # Phase 3 Object-Level Scenarios
  database_objects_overview:
    description: "Get overview of database objects (views, functions, indexes)"
    max_tool_calls: 5
    timeout_seconds: 30
    queries:
      - "What views, functions, and indexes exist in this database?"
      - "Show me all the database objects"
    expected_tools: ["list_views", "list_functions", "list_indexes"]
    expected_entities: ["views", "functions", "indexes", "count"]
    validation:
      require_object_counts: true

  object_inspection:
    description: "Inspect specific database objects"
    max_tool_calls: 4
    timeout_seconds: 25
    queries:
      - "Describe the anime table in detail including all constraints and indexes"
      - "What can you tell me about this table's structure?"
    expected_tools: ["describe_object", "get_table_constraints", "list_indexes"]
    expected_entities: ["columns", "constraints", "indexes", "PRIMARY KEY"]
    validation:
      require_constraint_details: true
      require_index_info: true

  query_performance_analysis:
    description: "Analyze query performance"
    max_tool_calls: 3
    timeout_seconds: 25
    queries:
      - "Explain how this query would execute: SELECT * FROM anime WHERE score > 8"
      - "What's the execution plan?"
    expected_tools: ["explain_query"]
    expected_entities: ["Seq Scan", "cost", "rows", "plan"]
    validation:
      require_execution_plan: true

  dependency_analysis:
    description: "Analyze object dependencies"
    max_tool_calls: 4
    timeout_seconds: 25
    queries:
      - "What are the dependencies for the anime table?"
      - "What objects depend on this table?"
    expected_tools: ["get_dependencies", "describe_object"]
    expected_entities: ["depends_on", "referenced_by", "table"]
    validation:
      require_dependency_info: true

  constraint_analysis:
    description: "Analyze table constraints and relationships"
    max_tool_calls: 5
    timeout_seconds: 30
    queries:
      - "What are the foreign key relationships in this database?"
      - "Show me all table constraints"
    expected_tools: ["get_table_constraints", "list_tables"]
    expected_entities: ["FOREIGN KEY", "PRIMARY KEY", "constraints", "anime", "studios"]
    validation:
      require_foreign_keys: true
      require_primary_keys: true

  # Phase 4 Data Query Scenarios - Real data retrieval with schema exploration
  anime_data_queries:
    description: "Query anime data with proper schema exploration first"
    max_tool_calls: 8
    timeout_seconds: 45
    queries:
      - "I want to know the top 3 anime that aired in 2022. Can you help me find this information?"
      - "What are the highest rated anime in the database?"
      - "Show me all anime with excellent ratings - those scoring above 8.5."
    expected_tools: ["list_tables", "describe_table", "execute_sql_query"]
    expected_entities: ["score", "title", "SQL", "aired_from", "2022"]
    validation:
      require_data_results: true
      require_ranking: true
      expect_anime_titles: true
      require_schema_exploration: true

  studio_data_analysis:
    description: "Analyze studio data with schema-aware exploration"
    max_tool_calls: 7
    timeout_seconds: 40
    queries:
      - "Which studios have produced the most anime? I'd like to understand the relationship between studios and anime."
      - "Can you show me the top studios by anime production count with their details?"
      - "I'm interested in studios that have produced high-quality anime. What can you find?"
    expected_tools: ["list_tables", "describe_table", "get_table_constraints", "execute_sql_query"]
    expected_entities: ["studio", "count", "name", "founded_year", "JOIN"]
    validation:
      require_aggregation: true
      require_studio_counts: true
      require_relationship_understanding: true

  temporal_data_queries:
    description: "Query anime data by time periods"
    max_tool_calls: 4
    timeout_seconds: 35
    queries:
      - "Execute a SQL query to show anime distribution by release year. Use EXTRACT(YEAR FROM aired_from) to group by year and count anime."
      - "Run a SQL query to get anime count by year with years sorted ascending."
      - "Use SQL to find the highest scored anime from each year where aired_from is not null."
    expected_tools: ["execute_sql_query"]
    expected_entities: ["EXTRACT", "aired_from", "GROUP BY", "COUNT"]
    validation:
      require_temporal_grouping: true
      require_year_data: true

  advanced_data_insights:
    description: "Complex analysis with error recovery and schema exploration"
    max_tool_calls: 10
    timeout_seconds: 60
    queries:
      - "I want to understand which studios produced the highest rated anime. Can you analyze this relationship including when these anime first aired?"
      - "Find anime that are both highly rated and popular. What makes them special?"
      - "Give me a comprehensive analysis of anime ratings and popularity patterns in the database."
    expected_tools: ["discover_tables", "inspect_table_schema", "get_table_constraints", "safe_read_query", "column_statistics"]
    expected_entities: ["JOIN", "score", "popularity", "ranked", "statistics", "studio_id", "aired_from"]
    validation:
      require_joins: true
      require_complex_filtering: true
      require_statistical_analysis: true
      require_schema_exploration: true
      expect_error_recovery: true

  # New scenario specifically for testing multi-round error recovery
  schema_exploration_with_errors:
    description: "Test error recovery through schema exploration"
    max_tool_calls: 8
    timeout_seconds: 45
    queries:
      - "Show me the top anime by their ranking. I think there might be a 'rank' column."
      - "Get studio details with their ID information. I assume the ID column is called 'id'."
    expected_tools: ["describe_table", "execute_sql_query"]
    expected_entities: ["ranked", "studio_id", "column", "error", "retry"]
    validation:
      expect_sql_errors: true
      require_error_recovery: true
      require_column_name_correction: true